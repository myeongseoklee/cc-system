# Crystalize Prompt (프롬프트 압축 전략)

## 개요

**Crystalize Prompt**는 기존 AI 에이전트 지침을 효율적으로 압축하는 방법론입니다. 토큰 사용량을 줄이면서 의미 손실을 최소화하여, 비용을 절감하고 성능을 향상시키는 것이 목표입니다. 긴 프롬프트를 압축하거나 토큰 효율성을 개선할 때 사용됩니다.

## 주요 기능

- **의도 보존**: 각 지침의 근본 목적(WHY) 유지
- **고해상도 토큰화**: 긴 설명을 핵심 개념어로 대체
- **암묵적 지식 활용**: LLM이 이미 아는 것은 포인팅만
- **조건부 전개**: 세부사항을 조건부 구조로 정리
- **중복 제거**: 반복되는 동일 의도 통합

## 파일 위치

- **원본 파일**: `prompt/crystalize-prompt.md`

## 5가지 압축 원칙

### 1. 의도 보존

각 지침의 **근본 목적(WHY)** 은 반드시 유지합니다.

**나쁜 예**:
```
"코드를 작성할 때는 항상 주석을 달고, 변수명은 명확하게..." (삭제)
```

**좋은 예**:
```
"코드를 작성할 때는 항상 주석을 달고..."
→ "가독성 우선"
```

### 2. 고해상도 토큰화

긴 설명을 해당 도메인의 **핵심 개념어/인물/프레임워크 참조**로 대체합니다.

**나쁜 예**:
```
"협상 시에는 자신의 최선의 대안을 파악하고, 상대방이 동의하지 않을 경우
선택할 수 있는 다른 옵션을 명확히 하며..." (긴 설명)
```

**좋은 예**:
```
"협상 시에는..." → "BATNA 원칙 적용"
```

### 3. 암묵적 지식 레버리지

LLM이 이미 아는 것은 **활성화 신호만** 제공합니다.

**핵심**: 설명하지 말고 포인팅하라

**나쁜 예**:
```
"REST API는 HTTP 메서드를 사용하여 CRUD 작업을 수행하며,
GET은 읽기, POST는 생성, PUT은 수정, DELETE는 삭제..." (긴 설명)
```

**좋은 예**:
```
"REST API 설계 원칙 준수"
```

### 4. 조건부 전개 구조

세부사항은 **"[조건] → [동작]"** 형태로 정리합니다.

**나쁜 예**:
```
"사용자가 에러를 보고하면 에러 메시지를 분석하고,
스택 트레이스를 확인하며, 재현 단계를 문서화하고..."
```

**좋은 예**:
```
에러 보고 시 → 분석(메시지, 스택), 재현 단계 문서화
필요시 → 상세 로그 요청
```

### 5. 중복 제거

다른 표현으로 반복되는 **동일 의도를 통합**합니다.

**나쁜 예**:
```
1. "코드는 명확해야 합니다"
2. "가독성을 최우선으로 하세요"
3. "다른 개발자가 이해할 수 있게 작성하세요"
```

**좋은 예**:
```
"가독성 우선 (명확성, 이해 가능성)"
```

## 사용 방법

### 입력

기존 AI 에이전트 지침을 붙여넣습니다:

```
[여기에 기존 AI 에이전트 지침 붙여넣기]
```

### 압축 요청

이 문서의 5가지 원칙에 따라 압축을 요청합니다.

### 출력 형식

#### 1. 압축된 프롬프트

```
[압축 결과]
```

#### 2. 압축 맵 (Compression Map)

| 원본 섹션 | 압축 형태 | 사용된 고해상도 토큰 | 활성화되는 의미 네트워크 |
| --------- | --------- | -------------------- | ------------------------ |
| "REST API는 HTTP 메서드를..." | "REST API 원칙 준수" | REST API | HTTP 메서드, CRUD, 상태 코드 |
| "협상 시 대안 파악..." | "BATNA 원칙" | BATNA | 최선의 대안, 협상 전략 |

#### 3. 메타 분석

```
- 압축률: 65%
- 잠재적 정보 손실 영역:
  - 구체적인 예제 코드 (필요시 재생성 가능)
  - 단계별 상세 설명 (핵심만 유지)
- 검증 필요 사항:
  - "BATNA 원칙" 용어를 LLM이 정확히 이해하는지
  - 압축된 지침으로 동일한 결과 도출 가능한지
```

## 예제

### 압축 전

```
당신은 코드 리뷰 전문가입니다. 코드를 리뷰할 때는 다음 사항을 확인해야 합니다:

1. 코드의 가독성: 변수명이 명확한지, 함수가 단일 책임 원칙을 따르는지,
   주석이 적절히 작성되어 있는지 확인합니다.
2. 성능: 불필요한 반복문이나 중복 계산이 있는지,
   시간 복잡도와 공간 복잡도를 개선할 수 있는지 검토합니다.
3. 보안: SQL 인젝션, XSS, CSRF 등의 취약점이 있는지 확인하고,
   입력 검증이 제대로 이루어지는지 검토합니다.
4. 테스트: 단위 테스트와 통합 테스트가 충분히 작성되어 있는지,
   테스트 커버리지가 적절한지 확인합니다.

각 항목에 대해 상세한 피드백을 제공하고, 개선 방안을 제시합니다.
```

### 압축 후

```
코드 리뷰 전문가.

검토 항목:
1. 가독성 → SOLID 원칙, 명명 규칙
2. 성능 → Big-O 최적화
3. 보안 → OWASP Top 10 검증
4. 테스트 → 커버리지 충분성

각 항목 → 구체적 피드백 + 개선안
```

### 압축률

- **원본**: ~150 단어
- **압축**: ~40 단어
- **압축률**: 73%

## 핵심 개념/섹션

### 고해상도 토큰의 힘

"BATNA" 하나가 긴 설명 전체를 대체합니다:
- Best Alternative To a Negotiated Agreement
- 협상 전략의 핵심 개념
- 대안 파악의 중요성
- 협상력 강화 방법

### 의미 네트워크 활성화

LLM은 이미 방대한 지식을 가지고 있습니다. 압축된 프롬프트는 그 지식을 **활성화하는 신호**입니다.

```
"REST API 원칙" →
  HTTP 메서드, 상태 코드, 리소스 기반 URL,
  무상태성, 캐싱, 레이어 시스템 등 자동 활성화
```

### 조건부 전개의 효율성

```
일반 지침: "가독성 우선"
필요시 전개: "변수명 명확화, 함수 분리, 주석 추가"
```

초기 컨텍스트는 최소화, 필요할 때만 LLM이 자체 전개

## 적용 분야

1. **긴 시스템 프롬프트**: Agent/Skill의 프롬프트 압축
2. **반복 패턴**: 여러 곳에서 재사용되는 지침
3. **비용 최적화**: 토큰 사용량이 높은 프로젝트
4. **성능 향상**: 컨텍스트 윈도우 효율적 활용

## 관련 항목

- [design-pipeline](design-pipeline.md) - 복잡한 프로젝트 설계에서 압축 전략 활용
- [skill-creator](../SKILLS/skill-creator.md) - Skill 작성 시 간결성 원칙
- [INDEX](../INDEX.md) - 전체 프로젝트 구조

## 활용 팁

1. **점진적 압축**: 한 번에 모두 압축하지 말고 섹션별로 진행
2. **테스트**: 압축 전후 동일한 결과가 나오는지 확인
3. **도메인 용어 활용**: 해당 분야의 표준 용어 사용
4. **균형**: 과도한 압축은 오히려 이해를 방해할 수 있음

## 참고사항

- 압축은 수단이지 목적이 아님
- 명확성이 우선, 압축은 그 다음
- LLM의 지식 범위를 고려하여 압축
- 검증을 통해 정보 손실 최소화 확인
